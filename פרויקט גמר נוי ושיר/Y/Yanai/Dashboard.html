<!DOCTYPE html>
<html lang="en" dir="rtl">
<head>
    <!-- META SECTION -->
    <title>ינאי בתי צמיחה- תצוגת דו"חות</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="images/logo.PNG" type="image/x-icon" />
    <!-- END META SECTION -->
    <!-- CSS INCLUDE -->
    <link rel="stylesheet" type="text/css" id="theme" href="css/theme-default.css" />
    <link href="newCss/complaintdefault.css" rel="stylesheet" />
    <link href="newCss/dashboardStyle.css" rel="stylesheet" />
    <!-- EOF CSS INCLUDE -->
    <link href='https://fonts.googleapis.com/css?family=Rubik' rel='stylesheet'>
</head>
<body style="font-family:Rubik;">
    <!-- START PAGE CONTAINER -->
    <div class="page-container">

        <!-- START PAGE SIDEBAR -->
        <div class="page-sidebar">
            <!-- START X-NAVIGATION -->
            <ul class="x-navigation">
                <li class="xn-logo">
                    <a href="#">
                        <div class="profile">
                            <div id="profile" class="profile-image">

                            </div>
                        </div>
                        <div id="hellouser"></div>
                    </a>
                    <a href="#" class="x-navigation-control"></a>
                </li>
                <li>
                    <a href="Dashboard.html"><span class="fa fa-bar-chart-o"></span> <span class="xn-text">תצוגת דו"חות</span></a>
                </li>
                <li>
                    <a href="MyComplaints.html"><span class="fa fa-table"></span> <span class="xn-text">התלונות שלי</span></a>
                </li>
                <li>
                    <a href="ManagerComplaints.html"><span class="fa fa-file-text-o"></span> <span class="xn-text">פתיחת תלונה חדשה</span></a>
                </li>
                <li>
                    <a href="ArchivedComplaints.html"><span class="fa fa fa-archive"></span> <span class="xn-text">ארכיון תלונות</span></a>
                </li>
                <li>
                    <a href="PermissionsManage.html"><span class="fa fa-cogs"></span> <span class="xn-text">ניהול הרשאות</span></a>
                </li>
                <li>
                    <a href="Login.html"><span class="fa fa-sign-out"></span> <span class="xn-text">התנתק</span></a>
                </li>
            </ul>
            <!-- END X-NAVIGATION -->
        </div>
        <!-- END PAGE SIDEBAR -->
        <!-- PAGE CONTENT -->
        <div class="page-content">
            <!-- START X-NAVIGATION VERTICAL -->
            <ul class="x-navigation x-navigation-horizontal x-navigation-panel">
                <!-- TOGGLE NAVIGATION -->
                <li class="xn-icon-button">
                    <a href="#" class="x-navigation-minimize"><span class="fa fa-dedent"></span></a>
                </li>
                <!-- END TOGGLE NAVIGATION -->
            </ul>
            <!-- END X-NAVIGATION VERTICAL -->
            <!-- PAGE CONTENT WRAPPER -->
            <div class="page-content-wrap">

                <!-- START WIDGETS -->
                <div class="row">
                    <div class="col-md-3">
                        <div class="widget widget-default widget-item-icon" onclick="location.href='StatusReport.html?Closed';">
                            <div class="widget-data">
                                <div class="col-md-12 status">
                                    <table class="table table-bordered table-striped">
                                        <tr>
                                            <td>
                                                <div class="Tstatus">סטטוס- נסגר</div>
                                                לחץ לדו"ח המלא
                                                <div class="progress progress-small progress-striped active">
                                                    <div id="colorclosed" class="progress-bar" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                                                </div>
                                                <div id="subtitleclosed" class="widget-subtitle"></div>
                                            </td>
                                            <td class="numberofstatus">
                                                <div id="CountNumClosed"></div>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="widget widget-default widget-item-icon" onclick="location.href='StatusReport.html?Treatment';">
                            <div class="widget-data">
                                <div class="col-md-12 status">
                                    <table class="table table-bordered table-striped">
                                        <tr>
                                            <td>
                                                <div class="Tstatus">סטטוס- בטיפול</div>
                                                לחץ לדו"ח המלא
                                                <div class="progress progress-small progress-striped active">
                                                    <div id="colortreat" class="progress-bar" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                                                </div>
                                                <div id="subtitletreat" class="widget-subtitle"></div>
                                            </td>
                                            <td class="numberofstatus">
                                                <div id="CountNumTreat"></div>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="widget widget-default widget-item-icon" onclick="location.href='StatusReport.html?Waiting';">
                            <div class="widget-data">
                                <div class="col-md-12 status">
                                    <table class="table table-bordered table-striped">
                                        <tr>
                                            <td>
                                                <div class="Tstatus">סטטוס- ממתין לטיפול</div>
                                                לחץ לדו"ח המלא
                                                <div class="progress progress-small progress-striped active">
                                                    <div id="colorwait" class="progress-bar" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                                                </div>
                                                <div id="subtitlewait" class="widget-subtitle"></div>
                                            </td>
                                            <td class="numberofstatus">
                                                <div id="CountNumWait"></div>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="widget widget-default widget-item-icon" onclick="location.href='StatusReport.html?New';">
                            <div class="widget-data">
                                <div class="col-md-12 status">
                                    <table class="table table-bordered table-striped">
                                        <tr>
                                            <td>
                                                <div class="Tstatus">סטטוס- חדש</div>
                                                לחץ לדו"ח המלא
                                                <div class="progress progress-small progress-striped active">
                                                    <div id="colornew" class="progress-bar" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                                                </div>
                                                <div id="subtitlenew" class="widget-subtitle"></div>
                                            </td>
                                            <td class="numberofstatus">
                                                <div id="CountNumNew"></div>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- END WIDGETS -->

                <div class="row">
                    <div class="col-md-4">

                        <!-- START USERS ACTIVITY BLOCK -->
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <div class="panel-title-box">
                                    <h3>התפלגות בעיות לפי מוצרים</h3>
                                </div>
                            </div>
                            <div class="panel-body padding-0">
                                <div class="chart-holder" id="dashboard-bar-1" style="height: 200px;"></div>
                            </div>
                        </div>
                        <!-- END USERS ACTIVITY BLOCK -->

                    </div>
                    <div class="col-md-4">
                        <div class="panel panel-default" onclick="location.href='ByCustomerManagerReport.html';">
                            <div class="panel-heading">
                                <div class="panel-title-box">
                                    <h3 style="float:right;">התפלגות תלונות לפי מנהל תיק לקוח&nbsp;&nbsp;</h3><p style="float:right; margin:0px 0px 0px">לחץ לדו"ח המלא</p>
                                </div>
                            </div>
                            <div class="panel-body padding-0">
                                <div class="chart-holder" id="dashboard-donut-1" style="height: 200px;"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <div class="panel-title-box">
                                    <h3>התפלגות בעיות לפי סוג</h3>
                                </div>
                            </div>
                            <div class="panel-body">
                                <div style="padding: 10px 10px 0px;">
                                    <span class="dotsupply"></span>  אספקה &nbsp <span class="dotproduct"></span>  מוצר
                                </div>
                                <div>
                                    <div id="chart-10" style="height: 200px; margin-top: -28px;"><svg></svg></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="panel panel-default" onclick="location.href='NotClosed24HoursReport.html';">
                            <div class="panel-heading">
                                <div class="panel-title-box">
                                    <h3>תלונות שלא נסגרו מעל 24 שעות (לפי חודשים)</h3>
                                    לחץ לדו"ח המלא
                                </div>
                            </div>
                            <div class="panel-body padding-0">
                                <div class="chart-holder" id="dashboard-area-1" style="height: 200px;"></div>
                                <div class="block-full-width">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="panel panel-default" onclick="location.href='NoTreatment24HoursReport.html';">
                            <div class="panel-heading">
                                <div class="panel-title-box">
                                    <h3>תלונות שלא טופלו מעל 24 שעות (לפי חודשים)</h3>
                                    לחץ לדו"ח המלא
                                </div>
                            </div>
                            <div class="panel-body padding-0">
                                <div class="chart-holder" id="dashboard-area-2" style="height: 200px;"></div>
                                <div class="block-full-width">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- END PAGE CONTENT WRAPPER -->
        </div>
        <!-- END PAGE CONTENT -->
    </div>
    <!-- END PAGE CONTAINER -->
    <!-- START SCRIPTS -->
    <!-- START PLUGINS -->
    <script type="text/javascript" src="js/plugins/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="js/plugins/jquery/jquery-ui.min.js"></script>
    <script type="text/javascript" src="js/plugins/bootstrap/bootstrap.min.js"></script>
    <!-- END PLUGINS -->
    <!-- START THIS PAGE PLUGINS-->
    <script type='text/javascript' src='js/plugins/icheck/icheck.min.js'></script>
    <script type="text/javascript" src="js/plugins/mcustomscrollbar/jquery.mCustomScrollbar.min.js"></script>
    <script type="text/javascript" src="js/plugins/scrolltotop/scrolltopcontrol.js"></script>

    <script type="text/javascript" src="js/plugins/morris/raphael-min.js"></script>
    <script type="text/javascript" src="js/plugins/morris/morris.min.js"></script>
    <script type="text/javascript" src="js/plugins/rickshaw/d3.v3.js"></script>
    <script type="text/javascript" src="js/plugins/rickshaw/rickshaw.min.js"></script>
    <script type='text/javascript' src='js/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js'></script>
    <script type='text/javascript' src='js/plugins/jvectormap/jquery-jvectormap-world-mill-en.js'></script>
    <script type='text/javascript' src='js/plugins/bootstrap/bootstrap-datepicker.js'></script>
    <script type="text/javascript" src="js/plugins/owl/owl.carousel.min.js"></script>

    <script type="text/javascript" src="js/plugins/moment.min.js"></script>
    <script type="text/javascript" src="js/plugins/daterangepicker/daterangepicker.js"></script>
    <!-- END THIS PAGE PLUGINS-->
    <!-- START TEMPLATE -->
    <script type="text/javascript" src="js/settings.js"></script>

    <script type="text/javascript" src="js/plugins.js"></script>
    <script type="text/javascript" src="js/actions.js"></script>
    <script type="text/javascript" src="js/plugins/nvd3/lib/d3.v3.js"></script>
    <script type="text/javascript" src="js/plugins/nvd3/nv.d3.min.js"></script>
    <script src="Scripts/ajaxCalls.js"></script>
    <!-- END SCRIPTS -->
    <script>
        $(document).ready(function () {
            if (document.referrer == '') self.location = 'Login.html';
            if (localStorage["username"]) {
                userName = JSON.parse(localStorage["username"]);
            }
            document.getElementById("hellouser").innerText += "שלום, " + userName;
            ajaxCall("GET", "./api/Manager", "", getManagersSuccess, error)
        });

        function getManagersSuccess(data) {
            managers = data;
            for (var u = 0; u < managers.length; u++) {
                if (managers[u].ManagerName == userName) {
                    if (managers[u].PermissionType == 'M' || managers[u].PermissionType == 'CM') {
                        window.location.href = "MyComplaints.html";
                        break;
                    }
                    photo = managers[u].Photo;
                    break;
                }
            }
            document.getElementById("profile").innerHTML = '<img src="' + photo + '" />';
            ajaxCall("GET", "./api/Complaint", "", getComplaintSuccess, error)
        }

        function getComplaintSuccess(data) {
            complaints = data;
            countNew = 0;
            countWait = 0;
            countTreat = 0;
            countClosed = 0;
            for (var i = 0; i < complaints.length; i++) {
                if (complaints[i].StatName1 == "חדש") {
                    countNew++;
                }
                else if (complaints[i].StatName1 == "נסגר") {
                    countClosed++;
                }
                else if (complaints[i].StatName1 == "בטיפול") {
                    countTreat++;
                }
                else {
                    countWait++;
                }
            }
            document.getElementById("CountNumNew").innerHTML = countNew;
            document.getElementById("CountNumWait").innerHTML = countWait;
            document.getElementById("CountNumTreat").innerHTML = countTreat;
            document.getElementById("CountNumClosed").innerHTML = countClosed;
            document.getElementById("colornew").style.width = (countNew / (complaints.length)) * 100 + "%";
            document.getElementById("colorwait").style.width = (countWait / (complaints.length)) * 100 + "%";
            document.getElementById("colortreat").style.width = (countTreat / (complaints.length)) * 100 + "%";
            document.getElementById("colorclosed").style.width = (countClosed / (complaints.length)) * 100 + "%";
            document.getElementById("subtitlenew").innerHTML = Math.round((countNew / (complaints.length)) * 100) + "%";
            document.getElementById("subtitlewait").innerHTML = Math.round((countWait / (complaints.length)) * 100) + "%";
            document.getElementById("subtitletreat").innerHTML = Math.round((countTreat / (complaints.length)) * 100) + "%";
            document.getElementById("subtitleclosed").innerHTML = Math.round((countClosed / (complaints.length)) * 100) + "%";
            ajaxCall("GET", "./api/Customer", "", getCustSuccess, error);
        }

        function getCustSuccess(data) {
            customers = data;
            ajaxCall("GET", "./api/Manager", "", getManagerSuccess, error);
        }

        function getManagerSuccess(data) {
            managers = data;
            ajaxCall("GET", "./api/Problem", "", getProbSuccess, error)
        }

        function getProbSuccess(data) {
            problems = data;
            //התפלגות תלונות לפי מנהל תיק לקוח
            CustomerCompCount = [];
            CustomerCompsum = [];
            for (var l = 0; l < complaints.length; l++) {
                CustomerCompCount.push(complaints[l].CusLogin);
            }
            CustomerUnique = CustomerCompCount.filter((v, i, a) => a.indexOf(v) === i);
            for (var j = 0; j < CustomerUnique.length; j++) {
                count = 0;
                for (var k = 0; k < complaints.length; k++) {
                    if (CustomerUnique[j] == complaints[k].CusLogin)
                        count++;
                }
                for (var g = 0; g < customers.length; g++) {
                    if (CustomerUnique[j] == customers[g].CustLogin) {
                        ManagerID = customers[g].ManagerID;
                        break;
                    }
                }
                for (var d = 0; d < managers.length; d++) {
                    if (ManagerID == managers[d].ManagerID) {
                        ManagerName = managers[d].ManagerName;
                        break;
                    }
                }
                CompSumPerCustomer = [];
                CompSumPerCustomer.push(ManagerName);
                CompSumPerCustomer.push(count);
                CustomerCompsum.push(CompSumPerCustomer);
            }
            for (var o = 0; o < CustomerCompsum.length; o++) {
                for (var f = 0; f < CustomerCompsum.length; f++) {
                    if (o == f) continue;
                    if (CustomerCompsum[o][0] == CustomerCompsum[f][0]) {
                        CustomerCompsum[o][1] = CustomerCompsum[o][1] + CustomerCompsum[f][1];
                        CustomerCompsum.splice(f, 1);
                    }
                }
            }
            chart = Morris.Donut({
                element: 'dashboard-donut-1',
                data: [{
                    "label": null,
                    "value": null
                }],
                colors: ['#009688', '#8bc34a', '#cddc39', '#5c72dd', '#5c0f5e', '#dda550', '#d15dd3', '#8fb0ec', '#ff91d3', '#33414E', '#1caf9a', '#FEA223', '#2196f3', '#ff5722', '#ffeb3b', '#607d8b', '#9e9e9e', '#00bcd4', '#e91e63', '#795548'],
                resize: true
            });
            chartStr = "[";
            for (var n = 0; n < CustomerCompsum.length; n++) {
                chartStr += '{ "label": "' + CustomerCompsum[n][0] + '", "value": ' + CustomerCompsum[n][1] + ' },'
            }
            chartStr = chartStr.substring(0, chartStr.length - 1);
            chartStr += "]";
            var Object = JSON.parse(chartStr);
            chart.setData(Object);

            //התפלגות בעיות לפי סוג
            supplyCount = 0;
            productCount = 0;
            for (var u = 0; u < problems.length; u++) {
                if (problems[u].ProbType == "מוצר") productCount++;
                else supplyCount++;
            }
            percentSupply = supplyCount;
            percentProduct = productCount;
            var myColors = ["#ee867e", "#FDB863"];
            d3.scale.myColors = function () {
                return d3.scale.ordinal().range(myColors);
            };
            nv.addGraph(function () {
                var chart = nv.models.pieChart().x(function (d) {
                    return d.label;
                }).y(function (d) {
                    return d.value;
                }).showLabels(true)//Display pie labels
                    .labelThreshold(.07)//Configure the minimum slice size for labels to show up
                    .labelType("percent")//Configure what type of data to show in the label. Can be "key", "value" or "percent"
                    .donut(true)//Turn on Donut mode. Makes pie chart look tasty!
                    .donutRatio(0.35)//Configure how big you want the donut hole size to be.
                    .color(d3.scale.myColors().range());;

                d3.select("#chart-10 svg").datum(exampleData()).transition().duration(350).call(chart);

                return chart;
            });

            //Pie chart example data. Note how there is only a single array of key-value pairs.
            function exampleData() {
                return [{
                    "label": "מוצר",
                    "value": percentProduct
                }, {
                    "label": "אספקה",
                    "value": percentSupply
                }];
            }
            //התפלגות בעיות לפי מוצרים
            proditem = [];
            prodsum = [];
            for (var t = 0; t < problems.length; t++) {
                if (problems[t].ProbType == "מוצר") {
                    for (var y = 0; y < complaints.length; y++) {
                        if (problems[t].CompID == complaints[y].CompID) {
                            oneDay = 24 * 60 * 60 * 1000;
                            today = new Date();
                            minusdates = Math.round(Math.abs((today - new Date(complaints[y].OpenDate)) / oneDay));
                            if (minusdates <= 30) {
                                proditem.push(problems[t].ProductName);
                                break;
                            }
                        }
                    }
                }
            }
            proditem = proditem.filter((v, i, a) => a.indexOf(v) === i);
            for (var e = 0; e < proditem.length; e++) {
                count = 0;
                probsumperprod = [];
                for (var p = 0; p < problems.length; p++) {
                    if (problems[p].ProbType == "מוצר") {
                        if (problems[p].ProductName == proditem[e]) {
                            for (var y = 0; y < complaints.length; y++) {
                                if (problems[p].CompID == complaints[y].CompID) {
                                    oneDay = 24 * 60 * 60 * 1000;
                                    today = new Date();
                                    minusdates = Math.round(Math.abs((today - new Date(complaints[y].OpenDate)) / oneDay));
                                    if (minusdates <= 30) {
                                        count++;
                                    }
                                }
                            }
                        }
                    }
                }

                probsumperprod.push(proditem[e]);
                probsumperprod.push(count);
                prodsum.push(probsumperprod);
            }
            BarChart = Morris.Bar({
                element: 'dashboard-bar-1',
                data: [{
                    "y": null,
                    "a": null
                }],
                xkey: 'y',
                ykeys: 'a',
                labels: ["מס' בעיות", "שם המוצר"],
                barColors: ['#33414E'],
                gridTextSize: '10px',
                hideHover: true,
                resize: true,
                gridLineColor: '#E5E5E5'
            });
            FiveHighest = [];
            if (prodsum.length > 5) {
                for (var a = 0; a < 5; a++) {
                    highSum = 0;
                    for (var b = 0; b < prodsum.length; b++) {
                        if (prodsum[b][1] > highSum) {
                            highSum = prodsum[b][1];
                            highItem = prodsum[b];
                            index = b;
                        }

                    }
                    FiveHighest.push(highItem);
                    prodsum.splice(index, 1);
                }
                ProdutsString = "[";
                for (var g = 0; g < FiveHighest.length; g++) {
                    ProdutsString += '{ "y": "' + FiveHighest[g][0] + '", "a": ' + FiveHighest[g][1] + ' },'
                }
                ProdutsString = ProdutsString.substring(0, ProdutsString.length - 1);
                ProdutsString += "]";
                var ObjectBarChart = JSON.parse(ProdutsString);
                BarChart.setData(ObjectBarChart);
            }
            else {
                ProdutsString = "[";
                for (var h = 0; h < prodsum.length; h++) {
                    ProdutsString += '{ "y": "' + prodsum[h][0] + '", "a": ' + prodsum[h][1] + ' },'
                }
                ProdutsString = ProdutsString.substring(0, ProdutsString.length - 1);
                ProdutsString += "]";
                var ObjectBarChart = JSON.parse(ProdutsString);
                BarChart.setData(ObjectBarChart);
            }

            CurrentYear = new Date().getFullYear();
            //תלונות שלא נסגרו מעל 24 שעות (לפי חודשים)
            difObjectsClosed = [{ y: CurrentYear + '-01', a: 0 },
            { y: CurrentYear + '-02', a: 0 },
            { y: CurrentYear + '-03', a: 0 },
            { y: CurrentYear + '-04', a: 0 },
            { y: CurrentYear + '-05', a: 0 },
            { y: CurrentYear + '-06', a: 0 },
            { y: CurrentYear + '-07', a: 0 },
            { y: CurrentYear + '-08', a: 0 },
            { y: CurrentYear + '-09', a: 0 },
            { y: CurrentYear + '-10', a: 0 },
            { y: CurrentYear + '-11', a: 0 },
            { y: CurrentYear + '-12', a: 0 }];
            for (var s = 0; s < complaints.length; s++) {
                if (complaints[s].StatName1 == "נסגר" && (new Date(complaints[s].OpenDate).getFullYear()) == CurrentYear) {
                    firstDate = new Date(complaints[s].LastUpdate);
                    secondDate = new Date(complaints[s].OpenDate);
                    const milliseconds = Math.abs(firstDate - secondDate);
                    if (firstDate.getMonth() > 9) strDate = secondDate.getFullYear() + '-' + (secondDate.getMonth() + 1);
                    else strDate = secondDate.getFullYear() + '-0' + (secondDate.getMonth() + 1);
                    const hours = milliseconds / 36e5;
                    if (hours > 24) {
                        for (var y = 0; y < difObjectsClosed.length; y++) {
                            if (difObjectsClosed[y].y == strDate) difObjectsClosed[y].a++;
                        }
                    }
                }
            }
            ClosedChart = Morris.Area({
                element: 'dashboard-area-1',
                data: [],
                xkey: 'y',
                ykeys: 'a',
                labels: ["מס' תלונות", 'Event'],
                resize: true,
                hideHover: true,
                xLabels: null,
                gridTextSize: '10px',
                lineColors: ['#1caf9a'],
                gridLineColor: '#E5E5E5'
            });
            ClosedChart.setData(difObjectsClosed);

            //תלונות שלא טופלו מעל 24 שעות (לפי חודשים)
            difObjectsTreat = [{ y: CurrentYear + '-01', a: 0 },
            { y: CurrentYear + '-02', a: 0 },
            { y: CurrentYear + '-03', a: 0 },
            { y: CurrentYear + '-04', a: 0 },
            { y: CurrentYear + '-05', a: 0 },
            { y: CurrentYear + '-06', a: 0 },
            { y: CurrentYear + '-07', a: 0 },
            { y: CurrentYear + '-08', a: 0 },
            { y: CurrentYear + '-09', a: 0 },
            { y: CurrentYear + '-10', a: 0 },
            { y: CurrentYear + '-11', a: 0 },
            { y: CurrentYear + '-12', a: 0 }];
            for (var w = 0; w < complaints.length; w++) {
                if ((complaints[w].StatName1 == "ממתין לטיפול" || complaints[w].StatName1 == "חדש") && (new Date(complaints[w].OpenDate).getFullYear()) == CurrentYear) {
                    firstDate = new Date();
                    secondDate = new Date(complaints[w].OpenDate);
                    const milliseconds = Math.abs(firstDate - secondDate);
                    if (firstDate.getMonth() > 9) strDate = secondDate.getFullYear() + '-' + (secondDate.getMonth() + 1);
                    else strDate = secondDate.getFullYear() + '-0' + (secondDate.getMonth() + 1);
                    const hours = milliseconds / 36e5;
                    if (hours > 24) {
                        for (var v = 0; v < difObjectsTreat.length; v++) {
                            if (difObjectsTreat[v].y == strDate) difObjectsTreat[v].a++;
                        }
                    }
                }
                else if (complaints[w].OnTreatDate != "" && (new Date(complaints[w].OpenDate).getFullYear()) == CurrentYear) {
                    firstDate1 = new Date(complaints[w].OnTreatDate);
                    secondDate1 = new Date(complaints[w].OpenDate);
                    const milliseconds1 = Math.abs(firstDate1 - secondDate1);
                    if (firstDate1.getMonth() > 9) strDate1 = secondDate1.getFullYear() + '-' + (secondDate1.getMonth() + 1);
                    else strDate1 = secondDate1.getFullYear() + '-0' + (secondDate1.getMonth() + 1);
                    const hours1 = milliseconds1 / 36e5;
                    if (hours1 > 24) {
                        for (var z = 0; z < difObjectsTreat.length; z++) {
                            if (difObjectsTreat[z].y == strDate1) difObjectsTreat[z].a++;
                        }
                    }
                }
            }
            TreatChart = Morris.Area({
                element: 'dashboard-area-2',
                data: [],
                xkey: 'y',
                ykeys: 'a',
                labels: ["מס' תלונות", 'Event'],
                resize: true,
                hideHover: true,
                xLabels: null,
                gridTextSize: '10px',
                lineColors: ['#1caf9a'],
                gridLineColor: '#E5E5E5'
            });
            TreatChart.setData(difObjectsTreat);
        }

        function error(err) {
            console.log(err);
        }
    </script>
    <!-- END TEMPLATE -->
    <!-- END SCRIPTS -->
</body>
</html>






